// <file>
//     <copyright see="prj:///doc/copyright.txt"/>
//     <license see="prj:///doc/license.txt"/>
//     <owner name="Matthew Ward" email="mrward@users.sourceforge.net"/>
//     <version>$Revision$</version>
// </file>

using System;
using ICSharpCode.WixBinding;
using NUnit.Framework;
using WixBinding.Tests.Utils;

namespace WixBinding.Tests.PackageFiles
{
	[TestFixture]
	public class ActiveViewChangedWhenPackageFilesViewOpenTestFixture : ActiveViewChangedWhenPackageFilesOpenTestFixtureBase
	{
		protected override void AfterInit()
		{
			// User switches to text editor with WiX document that we are currently showing
			// in the PackageFilesView.
			workbench.ActiveViewContent = viewWithOpenWixDocument;
			workbench.RaiseActiveViewContentChangedEvent();
		}
		
		[Test]
		public void CheckThatWixDocumentWindowIsActiveReturnsTrueForWixDocumentUsedWhenSettingUpTest()
		{
			WixDocumentWindow window = new WixDocumentWindow(workbench);
			Assert.IsTrue(window.IsActive(document));
		}
		
		[Test]
		public void PackageFilesControlShowFilesMethodCalledWhenUserSwitchesBackToPackageFilesViewWindow()
		{
			workbench.ActiveViewContent = packageFilesView;
			workbench.RaiseActiveViewContentChangedEvent();
			
			Assert.AreEqual(project, packageFilesControl.ShowFilesMethodProjectParameter);
		}
		
		[Test]
		public void PackageFilesControlsShowFilesNotInitiallyCalled()
		{
			Assert.IsNull(packageFilesControl.ShowFilesMethodProjectParameter);
		}
		
		[Test]
		public void PackageFilesControlShowFilesMethodIsNotCalledAfterPackageFilesViewIsDisposed()
		{
			workbench.ActiveViewContent = packageFilesView;
			packageFilesView.Dispose();
			workbench.RaiseActiveViewContentChangedEvent();
			
			Assert.IsNull(packageFilesControl.ShowFilesMethodProjectParameter);
		}
	}
}
